<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å¿ƒå¤©æ°£ç´€éŒ„</title>

    <link rel="stylesheet" href="style.css"> <!-- ä½ çš„ä¸» CSS -->

    <style>
        /* é€™è£¡åªä¿ç•™é é¢è‡ªå·±çš„ layoutï¼Œä¸æ”¾è¡¨æ ¼ CSS */
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: var(--bg-blue);
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 28px;
            color: var(--blue-main);
            font-size: 30px;
        }

        .history-table-wrapper {
            max-width: 960px;
            margin: 0 auto;
        }
    </style>
</head>

<body>

    <h1>ğŸ“˜ æˆ‘çš„å¿ƒå¤©æ°£ç´€éŒ„</h1>

    <!-- è¡¨æ ¼å®¹å™¨ -->
    <div class="history-table-wrapper">
        <div id="historyOutput" class="history-section"></div>
    </div>

    <script>
        //-----------------------------------------
        // ğŸ“„ è®€å– Google Sheetï¼ˆCSVï¼‰
        //-----------------------------------------

        document.addEventListener("DOMContentLoaded", async () => {
            const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vReMWrHOhNT6Ia8CHhYBO7wWN7tADRCL8vFKJTAIwPnWOEwuZioYWEoOBX_bFY7pizn5VRpkRxpy29b/pub?output=csv";

            const myUserId = localStorage.getItem("userId");
            console.log("My userId:", myUserId);

            async function loadCSV() {
                const response = await fetch(CSV_URL);
                const text = await response.text();
                return text.split("\n").map(row => row.split(","));
            }

            const rows = await loadCSV();
            const header = rows[0];
            const dataRows = rows.slice(1);

            // éæ¿¾è‡ªå·±çš„ç´€éŒ„
            const myData = dataRows.filter(row => row[1] === myUserId);

            const output = document.getElementById("historyOutput");

            if (myData.length === 0) {
                output.innerHTML = "<p style='padding:20px;'>ç›®å‰æ²’æœ‰æ‰¾åˆ°ä½ çš„ç´€éŒ„ã€‚</p>";
                return;
            }

            // ç”Ÿæˆè¡¨æ ¼ HTML
            let tableHtml = `
            <div class="history-table-wrapper">
                <table class="history-table">
                    <thead><tr>`;

            header.forEach(title => {
                tableHtml += `<th>${title}</th>`;
            });

            tableHtml += `</tr></thead><tbody>`;

            myData.forEach(row => {
                tableHtml += `<tr>`;
                row.forEach((col, index) => {
                    if (header[index] === "weather") {
                        tableHtml += `<td class="weather-cell">${col}</td>`;
                    } else {
                        tableHtml += `<td>${col}</td>`;
                    }
                });
                tableHtml += `</tr>`;
            });

            tableHtml += `</tbody></table></div>`;

            output.innerHTML = tableHtml;
        });
    </script>
</body>

</html>
